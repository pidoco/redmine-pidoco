<%# jsh: _ vs. - %>
<div class="pidoco_box box">
  <h3><%= l(:prototypes_for_project) %></h3>
	<% no_prototypes = true %>
	<ul>
	<% @project.pidoco_keys.each do |pidoco_key| %>
	  <% if prototype = pidoco_key.prototype %>
			<% no_prototypes = false %>
			<li><%= link_to(h(prototype.name), 
	          :controller => :discussions, 
	          :action => :index, 
	          :project => @project, 
	          :anchor => "prototype_#{prototype.id}") %>: <%= l(:last_changed_on) %> <%= format_time(Time.at(Integer(prototype.last_modified)/1000)) %><br/>
	
				<%# jsh: this should go into a helper %>
				<% discussions = prototype.discussions
				lastDiscussed = Time.at(0)
				discussions.each do |discussion|
					if lastDiscussed < discussion[:last_discussed_at]
						lastDiscussed = discussion[:last_discussed_at]
					end
				end %>
	
				<% if discussions.size > 0 %>
	      			<%= discussions.size %> <%= l(:label_discussion_plural)%>, <%= l(:last_entry_on) %> <%= format_time(lastDiscussed) %>
				<% else %>
					<%= l(:no_discussions) %>
				<% end %>
			</li>
		<% end %>
	<% end %>
	</ul>
	<% if no_prototypes %>
		<%= l(:no_prototypes_available) %>
	<% else %>
		<%= link_to(l(:view_all_discussions), 
	      :controller => :discussions, 
	      :action => :index, 
	      :project => @project) %>
	<% end%>
</div>

<% content_for :header_tags do %>
  <%= stylesheet_link_tag "pidoco.css", :plugin => "redmine_pidoco" %>
<% end %>
